// Copyright 2023 QMK
// SPDX-License-Identifier: GPL-2.0-or-later
// CONSUME <> ENHANCE <> REPLICATE

#include QMK_KEYBOARD_H
#include <keyboard.h> 

enum combos {
    GAME
};

const uint16_t PROGMEM game_combo[] = {KC_F2, KC_F3, KC_F4, COMBO_END};
const uint16_t PROGMEM exit_game_combo[] = {KC_1, KC_2, KC_3, COMBO_END};
combo_t key_combos[] = {
    COMBO(game_combo, TO(2)),
    COMBO(exit_game_combo, TO(0))

};


enum tap_dance {
    TD_PARENTHESIS
};

tap_dance_action_t tap_dance_actions[] = {
    // Tap once for (, twice for )
    [TD_PARENTHESIS] = ACTION_TAP_DANCE_DOUBLE(KC_LPRN, KC_RPRN)
};


const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = LAYOUT(
        QK_GESC, KC_1, KC_2,   KC_3,   KC_4,   KC_5,                  KC_6, KC_7, KC_8,     KC_9,   KC_0,    KC_BSPC,
        KC_TAB,  KC_Q, KC_W,   KC_E,   KC_R,   KC_T,        KC_RALT,  KC_Y, KC_U, KC_I,     KC_O,   KC_P,    KC_BSLS,
        KC_LGUI, KC_A, KC_S,   KC_D,   KC_F,   KC_G,        KC_RGUI,  KC_H, KC_J, KC_K,     KC_L,   KC_SCLN, KC_QUOTE,
        KC_LCTL, KC_Z, KC_X,   KC_C,   KC_V,   KC_B,        KC_RCTL,  KC_N, KC_M, KC_COMMA, KC_DOT, KC_SLSH, KC_RCTL,

        KC_LEFT, KC_RIGHT, KC_SPACE,   KC_LSFT, KC_ENTER,   KC_ENTER, KC_RSFT, KC_SPACE, KC_UP, KC_DOWN,                         
                                       KC_BSPC, MO(1),      MO(1), KC_BSPC                       
    ),

    [1] = LAYOUT(
        _______, KC_F1, KC_F2, KC_F3,  KC_F4,  KC_F5,                  KC_F6,    KC_F7,   KC_F8,    KC_F9,   KC_F10,                KC_F11,
        _______, KC_Q,  KC_W,   KC_E,   KC_R,   KC_T,        _______,  KC_MINS,  KC_EQL,  KC_LBRC,  KC_RBRC, TD(TD_PARENTHESIS),    _______,
        _______, KC_A,  KC_S,   KC_D,   KC_F,   KC_G,        _______,  KC_H,     KC_J,    KC_K,     KC_L,    KC_SCLN,               KC_QUOTE,
        _______, KC_Z,  KC_X,   KC_C,   KC_V,   KC_B,        _______,  KC_N,     KC_M,    KC_COMMA, KC_DOT,  KC_SLSH,               KC_RCTL,

        _______, _______, _______,     KC_LSFT, KC_ENTER,    KC_ENTER, KC_RSFT, KC_SPACE, MS_BTN1, MS_BTN2,                        
                                       KC_BSPC, _______,     _______, KC_BSPC                       
    ),
    //Layer For Games
    [2] = LAYOUT(
        _______, KC_F1,   KC_1,   KC_2,   KC_3,   KC_4,                 XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        KC_TAB,  KC_M,    KC_Q,   KC_W,   KC_E,   KC_R,        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        KC_LALT, KC_LSFT, KC_A,   KC_S,   KC_D,   KC_F,        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        KC_HOME, KC_LCTL, KC_Z,   KC_X,   KC_C,   KC_B,        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,

        KC_LBRC, KC_RBRC, KC_SPACE,    KC_H, KC_G,             XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                         
                                       KC_V, KC_B,             XXXXXXX, XXXXXXX     
    )
    
};

#ifdef OLED_ENABLE

static const char PROGMEM siva_logo[] = {
// 'prime_perfected', 32x32px
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xf0, 0xf8, 0xfc, 
0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x18, 0x1c, 0x1e, 0x9f, 0xdf, 0xff, 0x0f, 0x07, 0x03, 0x01, 
0x01, 0x83, 0xc7, 0xef, 0xff, 0xff, 0xff, 0xfe, 0x7c, 0xb8, 0xd0, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xfc, 0xfe, 0x7f, 0x3f, 0x1f, 0x0f, 0x00, 0x00, 0x00, 0x00, 
0x7f, 0xbf, 0xdf, 0xef, 0xf7, 0xfb, 0xfd, 0x7e, 0x3f, 0x1f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x3f, 0x1f, 0x0f, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


static const char PROGMEM windows_logo[] = {
// 'tinywin', 32x22px
0x00, 0x00, 0x3c, 0x00, 0x00, 0x06, 0xfc, 0x00, 0x00, 0x1e, 0xfc, 0x00, 0x00, 0x1e, 0xfc, 0x00, 
0x00, 0x1e, 0xfc, 0x00, 0x00, 0x1e, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0xfc, 0x00, 
0x00, 0x1e, 0xfc, 0x00, 0x00, 0x1e, 0xfc, 0x00, 0x00, 0x1e, 0xfc, 0x00, 0x00, 0x06, 0xfc, 0x00, 
0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const char PROGMEM linux_logo[] = {
    // tux, 32x22px
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xf8, 0x6c, 0x3c, 
0x6c, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xee, 0xff, 0xe3, 0xc1, 0x81, 0x81, 
0xc1, 0xe3, 0xff, 0xec, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 
0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const char PROGMEM mac_ios_logo[] = {
    // 'apple logo', 32x22px
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xf0, 0xf0, 0xf0, 0xf0, 0xe0, 0xe0, 
0xec, 0xee, 0xf7, 0xf3, 0x70, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x3f, 0x7f, 0xff, 0xff, 0x7f, 0x7f, 
0x7f, 0xff, 0xff, 0x7f, 0x3c, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// Rotate OLED
oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    if (!is_keyboard_master()) {
        return OLED_ROTATION_270;  // flips the display 180 degrees if offhand
    }
    return OLED_ROTATION_90;  
}
#endif
static void print_status_left(void) {
        oled_set_cursor(0,1);
        oled_write_raw_P(siva_logo,sizeof(siva_logo));
        oled_set_cursor(0,7);
        oled_write("LAYER", false);
        switch (get_highest_layer(layer_state))
        {
            case 0 :
                oled_write("BASE", false);
                break;
            case 1 :
                oled_write("FUNC", false);
                break;
            case 2 :
                oled_write("GAME", false);
                break;
        }
        oled_set_cursor(0,12);
        os_variant_t host = detected_host_os();
            switch (host) 
            {
            case OS_MACOS:
                oled_write_raw_P(mac_ios_logo, sizeof(mac_ios_logo));
            case OS_IOS:
                oled_write_raw_P(mac_ios_logo, sizeof(mac_ios_logo));
                break;
            case OS_WINDOWS:
                oled_write_raw_P(windows_logo, sizeof(windows_logo));
                break;
            case OS_LINUX:
                oled_write_raw_P(linux_logo, sizeof(linux_logo));
                break;
            case OS_UNSURE:
                oled_write("OS?", false);
                break;
            }
        
        //oled_scroll_left();  // Turns on scrolling
    
}
static void print_status_right(void){
    // WPM Counter
    uint8_t n = get_current_wpm();
    char    wpm_str[4];
    oled_set_cursor(0,9);
    wpm_str[3] = '\0';
    wpm_str[2] = '0' + n % 10;
    wpm_str[1] = '0' + (n /= 10) % 10;
    wpm_str[0] = '0' + n / 10;
    oled_write("WPM:", false);
    oled_set_cursor(0,10);
    oled_write(wpm_str, false);
}

// Draw to OLED
bool oled_task_user() {
    if (!is_keyboard_master()) 
    {   
        print_status_right(); 
    }
    else 
    {
        print_status_left();
    } 
    return false;
}
bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  // If console is enabled, it will print the matrix position and status of each key pressed
#ifdef CONSOLE_ENABLE
    uprintf("KL: kc: 0x%04X, col: %2u, row: %2u, pressed: %u, time: %5u, int: %u, count: %u\n", keycode, record->event.key.col, record->event.key.row, record->event.pressed, record->event.time, record->tap.interrupted, record->tap.count);
#endif 
  return true;
}
